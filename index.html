<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cosmic Universal Idle</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>

    <style>
        :root {
            --bg-deep: #020204;
            --bg-panel: rgba(20, 25, 40, 0.95);
            --primary: #6366f1;
            --secondary: #ec4899;
            --accent: #22d3ee;
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-deep);
            color: #e2e8f0;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        /* --- UI COMPONENTS --- */
        .glass-panel {
            background: var(--bg-panel);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .btn-push {
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 3px solid rgba(0,0,0,0.4);
            position: relative;
            overflow: hidden;
        }
        .btn-push:active:not(:disabled) {
            transform: translateY(2px);
            border-bottom-width: 0px;
            margin-top: 2px;
        }
        .btn-push:disabled { opacity: 0.5; filter: grayscale(100%); cursor: not-allowed; border-bottom-width: 0px;}

        /* Main Clicker */
        .core-btn {
            width: 220px; height: 220px;
            border-radius: 50%;
            background: radial-gradient(circle at 40% 40%, #6366f1, #1e1b4b);
            box-shadow: 0 0 50px rgba(99, 102, 241, 0.3), inset 0 0 20px rgba(255,255,255,0.1);
            display: flex; align-items: center; justify-content: center;
            font-size: 5rem; cursor: pointer; 
            position: relative; z-index: 10;
            transition: transform 0.05s;
            border: 4px solid rgba(99, 102, 241, 0.3);
        }
        .core-btn:active { transform: scale(0.92); }
        
        /* Floating Text */
        .float-txt {
            position: absolute; pointer-events: none; font-weight: 900; font-size: 1.2rem;
            animation: floatUp 1s ease-out forwards; z-index: 50; text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            color: #fff;
        }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-80px) scale(1.5); opacity: 0; } }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Nav */
        .nav-item { @apply flex items-center p-3 rounded-lg cursor-pointer transition-colors text-gray-400 hover:text-white hover:bg-white/5 border border-transparent; }
        .nav-item.active { @apply bg-indigo-900/40 text-indigo-300 border-indigo-500/50 shadow-[0_0_15px_rgba(99,102,241,0.15)]; }

        /* Shop Items */
        .shop-item-card {
            @apply flex justify-between items-center bg-slate-800/50 p-3 rounded border border-white/5 mb-2 transition-colors;
        }
        .shop-item-card:hover { @apply bg-slate-800; }

        /* Highlight for Tutorial */
        .tutorial-highlight {
            position: relative;
            z-index: 100;
            box-shadow: 0 0 0 4px #fbbf24, 0 0 30px rgba(251, 191, 36, 0.8);
            border-color: #fbbf24 !important;
            animation: pulse-highlight 1s infinite;
            pointer-events: auto !important;
        }
        @keyframes pulse-highlight { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        
        .tutorial-overlay-bg {
            background-color: rgba(0,0,0,0.85);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="flex flex-col md:flex-row">

    <!-- TUTORIAL OVERLAY -->
    <div id="tutorial-overlay" class="fixed inset-0 z-[200] hidden tutorial-overlay-bg flex-col items-center justify-center pointer-events-auto">
        <div class="glass-panel p-8 max-w-md text-center border-2 border-yellow-400 shadow-2xl">
            <div class="text-5xl mb-4">ü§ñ</div>
            <h3 class="text-2xl font-bold text-yellow-400 mb-2" id="tut-title">System Online</h3>
            <p class="text-gray-300 mb-6 leading-relaxed" id="tut-text">Initializing pilot interface...</p>
            <button class="btn-push bg-green-600 hover:bg-green-500 text-white px-8 py-3 rounded-lg font-bold text-lg shadow-lg" onclick="nextTutorial()">CONTINUE</button>
        </div>
    </div>

    <!-- SIDEBAR (Desktop) / BOTTOM BAR (Mobile) -->
    <nav class="md:w-64 bg-[#080b14] border-r border-white/10 flex-shrink-0 flex flex-col z-50 md:relative fixed bottom-0 w-full md:h-full h-auto border-t md:border-t-0">
        <div class="p-6 hidden md:block border-b border-white/5">
            <h1 class="text-2xl font-black tracking-tight text-white">COSMIC<span class="text-indigo-500">IDLE</span></h1>
            <p class="text-[10px] text-gray-600 mt-1 tracking-widest uppercase">Offline Ready</p>
        </div>
        
        <!-- Nav Links -->
        <div class="flex md:flex-col overflow-x-auto md:overflow-visible p-2 md:p-4 gap-2 no-scrollbar" id="nav-container">
            <button id="nav-home" class="nav-item active" onclick="window.setTab('home')">
                <span class="text-xl mr-3">üåå</span> <span class="hidden md:inline font-bold">Core</span>
            </button>
            <button id="nav-upgrades" class="nav-item" onclick="window.setTab('upgrades')">
                <span class="text-xl mr-3">üõí</span> <span class="hidden md:inline font-bold">Shop</span>
            </button>
            <button id="nav-pets" class="nav-item" onclick="window.setTab('pets')">
                <span class="text-xl mr-3">üëæ</span> <span class="hidden md:inline font-bold">Pets</span>
            </button>
            <button id="nav-relics" class="nav-item" onclick="window.setTab('relics')">
                <span class="text-xl mr-3">üè∫</span> <span class="hidden md:inline font-bold">Relics</span>
            </button>
            <button id="nav-prestige" class="nav-item" onclick="window.setTab('prestige')">
                <span class="text-xl mr-3">‚ú®</span> <span class="hidden md:inline font-bold">Prestige</span>
            </button>
            <button id="nav-leaderboard" class="nav-item" onclick="window.setTab('leaderboard')">
                <span class="text-xl mr-3">üèÜ</span> <span class="hidden md:inline font-bold">Ranks</span>
            </button>
        </div>
    </nav>

    <!-- MAIN CONTENT AREA -->
    <main class="flex-grow relative h-full overflow-hidden flex flex-col">
        
        <!-- TOP BAR -->
        <div class="glass-panel m-2 md:m-4 p-4 flex flex-wrap justify-between items-center z-40 shrink-0">
            <div>
                <p class="text-[10px] text-indigo-400 uppercase tracking-widest font-bold">Cosmic Energy</p>
                <p class="text-3xl md:text-4xl font-black text-white font-mono tracking-tight" id="disp-ce">0</p>
            </div>
            <div class="text-right hidden sm:block">
                <p class="text-[10px] text-gray-500 uppercase">Income Rate</p>
                <p class="text-lg font-bold text-emerald-400 font-mono" id="disp-cps">0/s</p>
            </div>
            <div class="flex gap-4 text-center">
                <div class="bg-purple-900/30 px-3 py-1 rounded border border-purple-500/30">
                    <p class="text-[10px] text-purple-300 font-bold">STARDUST</p>
                    <p class="text-lg font-bold text-white" id="disp-sd">0</p>
                </div>
                <div class="bg-teal-900/30 px-3 py-1 rounded border border-teal-500/30">
                    <p class="text-[10px] text-teal-300 font-bold">SHARDS</p>
                    <p class="text-lg font-bold text-white" id="disp-gs">0</p>
                </div>
            </div>
        </div>

        <!-- SCROLLABLE CONTENT -->
        <div class="flex-grow overflow-y-auto p-4 pb-24 md:pb-4" id="main-scroll">
            
            <!-- TAB: HOME -->
            <div id="tab-home" class="tab-content h-full flex flex-col items-center justify-center min-h-[500px]">
                <button id="core-btn" class="core-btn mt-8 hover:scale-105 active:scale-95 transition-transform" onclick="clickCore(event)">
                    <span class="text-6xl drop-shadow-lg">‚öõÔ∏è</span>
                </button>
                <p class="mt-8 text-gray-400 text-sm animate-pulse">Tap to generate energy</p>
                <p class="mt-2 text-xs text-gray-600 font-mono" id="save-status">System Ready</p>
            </div>

            <!-- TAB: SHOP -->
            <div id="tab-upgrades" class="tab-content hidden max-w-3xl mx-auto space-y-6">
                <div class="flex justify-between items-end border-b border-white/10 pb-4">
                    <h2 class="text-3xl font-bold text-white">Upgrades</h2>
                </div>
                
                <div class="glass-panel p-6">
                    <h3 class="text-sm font-bold text-pink-400 uppercase tracking-widest mb-4">Click Power</h3>
                    <div id="list-click" class="grid grid-cols-1 gap-3">
                        <!-- Generated on Load -->
                    </div>
                </div>

                <div class="glass-panel p-6">
                    <h3 class="text-sm font-bold text-emerald-400 uppercase tracking-widest mb-4">Passive Income</h3>
                    <div id="list-idle" class="grid grid-cols-1 gap-3">
                         <!-- Generated on Load -->
                    </div>
                </div>
            </div>

            <!-- TAB: PETS -->
            <div id="tab-pets" class="tab-content hidden max-w-3xl mx-auto space-y-6">
                <h2 class="text-3xl font-bold text-white mb-2">Companion Roster</h2>
                <div id="pet-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>

            <!-- TAB: RELICS -->
            <div id="tab-relics" class="tab-content hidden max-w-4xl mx-auto">
                <h2 class="text-3xl font-bold text-amber-400 mb-2">Ancient Relics</h2>
                <p class="text-sm text-gray-400 mb-6">Rare artifacts that provide powerful global bonuses. Find them by playing!</p>
                
                <div id="relic-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <!-- Relics generated here -->
                </div>
            </div>

            <!-- TAB: PRESTIGE -->
            <div id="tab-prestige" class="tab-content hidden max-w-3xl mx-auto space-y-6">
                <div class="glass-panel p-6 border-l-4 border-purple-500">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-2xl font-bold text-white">Stardust Rebirth</h3>
                        <div class="text-right">
                            <p class="text-3xl font-black text-purple-400" id="val-sd-gain">+0</p>
                            <p class="text-[10px] text-gray-500 uppercase">Potential Gain</p>
                        </div>
                    </div>
                    <p class="text-sm text-gray-400 mb-4">Reset CE & Upgrades. Gain +5% Global Multiplier per Stardust.</p>
                    <button class="btn-push w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 rounded-lg" onclick="doPrestige(1)">
                        REBIRTH (Req: 1M CE)
                    </button>
                </div>
                <!-- Tier 2 -->
                 <div class="glass-panel p-6 border-l-4 border-teal-500 opacity-90 hover:opacity-100 transition">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">Galactic Shift</h3>
                        <div class="text-right">
                            <p class="text-2xl font-black text-teal-400" id="val-gs-gain">+0</p>
                        </div>
                    </div>
                     <p class="text-sm text-gray-400 mb-4">Reset Stardust. Unlocks advanced automation.</p>
                    <button class="btn-push w-full mt-4 bg-teal-700 text-white font-bold py-3 rounded-lg disabled:opacity-50" id="btn-prestige-2" onclick="doPrestige(2)">
                        ASCEND (Req: 100 SD)
                    </button>
                </div>
            </div>
            
            <!-- TAB: LEADERBOARD -->
            <div id="tab-leaderboard" class="tab-content hidden max-w-3xl mx-auto">
                <h2 class="text-3xl font-bold text-yellow-400 mb-4">Galactic Rankings</h2>
                <div class="glass-panel p-4">
                     <p class="text-gray-400 text-sm mb-4 text-center italic">Leaderboard requires cloud sync. You are currently in Local Mode.</p>
                     <ul id="leaderboard-list" class="space-y-2 text-gray-300">
                         <li class="text-center">Simulating local rankings...</li>
                     </ul>
                </div>
            </div>

        </div>
    </main>

    <script type="module">
        // --- NO FIREBASE DEPENDENCY FOR THIS VERSION TO ENSURE IT WORKS ---
        // Using LocalStorage for robust offline play
        
        // --- GAME DATA ---
        const UPGRADES = {
            c1: { name: 'Focus Lens', base: 15, mult: 1.5, power: 1, type: 'click' },
            c2: { name: 'Quantum Tap', base: 250, mult: 1.6, power: 15, type: 'click' },
            c3: { name: 'Singularity', base: 5000, mult: 1.8, power: 150, type: 'click' },
            i1: { name: 'Solar Panel', base: 50, mult: 1.4, power: 1, type: 'idle' },
            i2: { name: 'Auto-Miner', base: 500, mult: 1.5, power: 12, type: 'idle' },
            i3: { name: 'Dyson Sphere', base: 10000, mult: 1.6, power: 200, type: 'idle' }
        };
        
        const PETS = [
            { id: 0, name: "Star Wisp", bonus: 0.01, desc: "Your starting companion.", req: "None" },
            { id: 1, name: "Void Golem", bonus: 0.05, desc: "+5% Global Multiplier", req: "Unlock at 10 Stardust" },
            { id: 2, name: "Nebula Jelly", bonus: 0.10, desc: "+10% Global Multiplier", req: "Unlock at 1 Galaxy Shard" },
            { id: 3, name: "Solar Phoenix", bonus: 0.25, desc: "+25% Global Multiplier", req: "Unlock at Prestige Tier 3" }
        ];
        
        const RELICS = [
            { id: 'r1', name: "Quantum Dice", desc: "Small chance for 10x click", icon: "üé≤", hint: "Random drop from clicking" },
            { id: 'r2', name: "Time Hourglass", desc: "Idle gain +20%", icon: "‚è≥", hint: "Random drop from Auto-Clicker" },
            { id: 'r3', name: "Infinity Prism", desc: "Prestige gain +10%", icon: "üíé", hint: "Unlocked at 100 Stardust" }
        ];

        let state = {
            ce: 0, sd: 0, gs: 0, uf: 0,
            upgrades: { c1: 0, c2: 0, c3: 0, i1: 0, i2: 0, i3: 0 },
            relics: [],
            pet: { id: 0, lvl: 1, xp: 0 },
            tutorial: 0, 
            lastSave: Date.now()
        };

        // --- LOGIC ---
        function getCPC() {
            let base = 1;
            base += state.upgrades.c1 * UPGRADES.c1.power;
            base += state.upgrades.c2 * UPGRADES.c2.power;
            base += state.upgrades.c3 * UPGRADES.c3.power;
            const sdMult = 1 + (state.sd * 0.05);
            const petMult = 1 + (state.pet.lvl * PETS[state.pet.id].bonus);
            return base * sdMult * petMult;
        }

        function getCPS() {
            let base = 0;
            base += state.upgrades.i1 * UPGRADES.i1.power;
            base += state.upgrades.i2 * UPGRADES.i2.power;
            base += state.upgrades.i3 * UPGRADES.i3.power;
            const sdMult = 1 + (state.sd * 0.05);
            const relicMult = state.relics.includes('r2') ? 1.2 : 1;
            return base * sdMult * relicMult;
        }

        // --- ACTIONS ---
        window.clickCore = (e) => {
            let gain = getCPC();
            if (state.relics.includes('r1') && Math.random() < 0.05) {
                gain *= 10;
                createFloat("CRIT!", e.clientX, e.clientY - 50, '#facc15');
            }
            
            state.ce += gain;
            state.pet.xp++;
            
            if(state.pet.xp > state.pet.lvl * 100) {
                state.pet.lvl++;
                state.pet.xp = 0;
                createFloat("Pet Level Up!", window.innerWidth/2, window.innerHeight/2, '#ec4899');
            }
            
            // Tutorial Step 1
            if(state.tutorial === 1) {
                nextTutorial(); 
            }

            createFloat(`+${format(gain)}`, e.clientX, e.clientY);
            updateUI();
        };

        window.buyUpgrade = (id) => {
            const u = UPGRADES[id];
            const cost = Math.floor(u.base * Math.pow(u.mult, state.upgrades[id]));
            if (state.ce >= cost) {
                state.ce -= cost;
                state.upgrades[id]++;
                updateUI();
                updateShopButtons();
                
                // Tutorial Step 2
                if(state.tutorial === 2) {
                    nextTutorial(); 
                }
                saveGame();
            }
        };
        
        window.doPrestige = (tier) => {
             if (tier === 1 && state.ce >= 1000000) {
                 state.sd += Math.floor(state.ce / 1000000);
                 state.ce = 0;
                 state.upgrades = { c1: 0, c2: 0, c3: 0, i1: 0, i2: 0, i3: 0 };
                 updateUI();
                 saveGame();
             }
        }
        
        window.equipPet = (id) => {
            if (id === 0 || (id === 1 && state.sd >= 10) || (id === 2 && state.gs >= 1)) {
                state.pet.id = id;
                updateUI();
                saveGame();
            }
        }

        // --- UI ---
        function initShop() {
            const cList = document.getElementById('list-click');
            const iList = document.getElementById('list-idle');
            cList.innerHTML = ''; iList.innerHTML = '';
            
            for (const [k, v] of Object.entries(UPGRADES)) {
                const html = `
                    <div class="shop-item-card" id="card-${k}">
                        <div>
                            <div class="font-bold text-sm text-gray-200">${v.name} <span class="text-xs text-indigo-400" id="lvl-${k}">Lv0</span></div>
                            <div class="text-xs text-gray-500">+${v.power} ${v.type.toUpperCase()}</div>
                        </div>
                        <button id="btn-${k}" class="px-3 py-1 rounded text-xs font-bold bg-indigo-600 text-white" onclick="window.buyUpgrade('${k}')">
                            Loading...
                        </button>
                    </div>`;
                if (v.type === 'click') cList.innerHTML += html; else iList.innerHTML += html;
            }
        }

        function updateShopButtons() {
            for (const [k, v] of Object.entries(UPGRADES)) {
                const lvl = state.upgrades[k];
                const cost = Math.floor(v.base * Math.pow(v.mult, lvl));
                const canAfford = state.ce >= cost;
                
                const btn = document.getElementById(`btn-${k}`);
                const lvlLabel = document.getElementById(`lvl-${k}`);
                
                if (btn) {
                    btn.innerText = format(cost);
                    btn.className = `px-3 py-1 rounded text-xs font-bold transition-colors ${canAfford ? 'bg-indigo-600 text-white hover:bg-indigo-500' : 'bg-slate-700 text-gray-500 cursor-not-allowed'}`;
                    btn.disabled = !canAfford;
                }
                if (lvlLabel) lvlLabel.innerText = `Lv${lvl}`;
            }
        }

        function updateUI() {
            document.getElementById('disp-ce').innerText = format(state.ce);
            document.getElementById('disp-sd').innerText = format(state.sd);
            document.getElementById('disp-gs').innerText = format(state.gs);
            document.getElementById('disp-cps').innerText = format(getCPS());
            
            document.getElementById('val-sd-gain').innerText = format(Math.floor(state.ce / 1000000));

            updateShopButtons();
            
            const petGrid = document.getElementById('pet-grid');
            petGrid.innerHTML = '';
            PETS.forEach(p => {
                const unlocked = (p.id === 0) || (p.id === 1 && state.sd >= 10) || (p.id === 2 && state.gs >= 1);
                const active = state.pet.id === p.id;
                petGrid.innerHTML += `
                    <div class="bg-slate-800 p-3 rounded border ${active ? 'border-green-500' : (unlocked ? 'border-slate-600' : 'border-red-900 opacity-50')} cursor-pointer" onclick="window.equipPet(${p.id})">
                        <div class="font-bold ${unlocked ? 'text-white' : 'text-gray-500'}">${p.name}</div>
                        <div class="text-xs text-gray-400">${unlocked ? p.desc : p.req}</div>
                        ${active ? '<div class="text-xs text-green-400 mt-1">ACTIVE</div>' : ''}
                    </div>
                `;
            });
            
            const relicGrid = document.getElementById('relic-grid');
            relicGrid.innerHTML = '';
            RELICS.forEach(r => {
                const unlocked = state.relics.includes(r.id);
                relicGrid.innerHTML += `
                    <div class="bg-slate-800 p-3 rounded border ${unlocked ? 'border-yellow-500' : 'border-slate-700 opacity-50'}">
                        <div class="text-2xl text-center mb-1">${r.icon}</div>
                        <div class="font-bold text-xs text-center ${unlocked ? 'text-white' : 'text-gray-500'}">${unlocked ? r.name : '???'}</div>
                        <div class="text-[10px] text-center text-gray-400">${unlocked ? r.desc : r.hint}</div>
                    </div>
                `;
            });
        }

        function format(num) {
            if (num >= 1e9) return (num / 1e9).toFixed(2) + "B";
            if (num >= 1e6) return (num / 1e6).toFixed(2) + "M";
            if (num >= 1e3) return (num / 1e3).toFixed(2) + "K";
            return Math.floor(num).toLocaleString();
        }

        function createFloat(text, x, y, color='#fff') {
            const el = document.createElement('div');
            el.className = 'float-txt';
            el.innerText = text;
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            el.style.color = color;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        window.setTab = (id) => {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`tab-${id}`).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${id}`).classList.add('active');
            
            // Extra logic for dynamic tab updates
            if(id === 'leaderboard') simulateLeaderboard();
        };
        
        function simulateLeaderboard() {
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = '';
            // Fake data for offline mode
            const fakeData = [
                {name: "VoidWalker", val: 1e12},
                {name: "StarLord99", val: 5e9},
                {name: "CosmicCat", val: 1e6},
                {name: "YOU", val: state.ce}
            ];
            fakeData.sort((a,b) => b.val - a.val);
            
            fakeData.forEach((d, i) => {
                 list.innerHTML += `
                    <li class="flex justify-between bg-slate-800 p-2 rounded border-b border-white/5 ${d.name === 'YOU' ? 'border-l-4 border-indigo-500' : ''}">
                        <span class="font-mono text-yellow-500">#${i+1}</span>
                        <span class="text-gray-300 text-xs truncate w-24">${d.name}</span>
                        <span class="text-ce font-bold">${format(d.val)} CE</span>
                    </li>`;
            });
        }

        // --- TUTORIAL ---
        function startTutorial() {
            state.tutorial = 1;
            showTut("System initialized.<br>Tap the Core to generate Cosmic Energy.");
        }
        
        window.nextTutorial = () => {
            state.tutorial++;
            if(state.tutorial === 2) {
                window.setTab('upgrades');
                showTut("Excellent.<br>Now purchase your first upgrade from the Shop.");
            }
            if(state.tutorial === 3) {
                 document.getElementById('tutorial-overlay').classList.add('hidden');
                 document.getElementById('tutorial-overlay').classList.remove('flex');
                 state.tutorial = 99; 
                 saveGame();
            }
        }
        
        function showTut(text) {
            const overlay = document.getElementById('tutorial-overlay');
            overlay.classList.remove('hidden');
            overlay.classList.add('flex');
            document.getElementById('tut-text').innerHTML = text;
        }

        // --- SAVE/LOAD LOCALSTORAGE ---
        const SAVE_KEY = 'cosmic_idle_save_v1';

        function saveGame() {
            localStorage.setItem(SAVE_KEY, JSON.stringify(state));
            const status = document.getElementById('save-status');
            if(status) status.innerText = 'Saved.';
        }

        function loadGame() {
            const saved = localStorage.getItem(SAVE_KEY);
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    state = { ...state, ...parsed };
                } catch(e) { console.error("Save corrupt"); }
            } else {
                startTutorial();
            }
            updateUI();
        }

        // --- INIT ---
        function init() {
            initShop();
            loadGame();

            setInterval(() => {
                state.ce += getCPS() / 10;
                updateUI();
            }, 100);

            setInterval(saveGame, 5000);
            window.setTab('home');
        }

        window.onload = init;
    </script>
</body>
</html>
